#!/usr/bin/env bash
ADDR="192.168.0.127"
PORT=4000
CONNECTIVITY="3G" # 4G / 3GSlow / LTE / Native
RUNS=3
# More at https://sites.google.com/a/webpagetest.org/docs/advanced-features/webpagetest-restful-apis#TOC-Specifying-connectivity

set -e

# Wait until containers are ready
printf "\e[0;35m%-6s\e[m" "Waiting for server to respond"
while ! nc -z $ADDR $PORT; do sleep 1; done
printf "\r\e[K\e[0;35m%-6s\e[m\n" "Server responded"
# Run tests
printf "\e[0;35m%-6s\e[m" "Running benchmarks"
./batchtool/wpt_batch.py \
    --server=http://$ADDR:$PORT/ \
    --urlfile=./batchtool/urls.txt \
    --outputdir=./batchtool/results \
    --connectivity=$CONNECTIVITY \
    --runs=3
printf "\r\e[K\e[0;35m%-6s\e[m\n" "Finished running benchmarks"
